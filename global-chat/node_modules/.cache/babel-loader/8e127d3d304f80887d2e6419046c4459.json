{"ast":null,"code":"const Polling = require(\"./polling\");\n\nconst globalThis = require(\"../globalThis\");\n\nconst rNewline = /\\n/g;\nconst rEscapedNewline = /\\\\n/g;\n/**\r\n * Global JSONP callbacks.\r\n */\n\nlet callbacks;\n\nclass JSONPPolling extends Polling {\n  /**\r\n   * JSONP Polling constructor.\r\n   *\r\n   * @param {Object} opts.\r\n   * @api public\r\n   */\n  constructor(opts) {\n    super(opts);\n    this.query = this.query || {}; // define global callbacks array if not present\n    // we do this here (lazily) to avoid unneeded global pollution\n\n    if (!callbacks) {\n      // we need to consider multiple engines in the same page\n      callbacks = globalThis.___eio = globalThis.___eio || [];\n    } // callback identifier\n\n\n    this.index = callbacks.length; // add callback to jsonp global\n\n    callbacks.push(this.onData.bind(this)); // append to query string\n\n    this.query.j = this.index;\n  }\n  /**\r\n   * JSONP only supports binary as base64 encoded strings\r\n   */\n\n\n  get supportsBinary() {\n    return false;\n  }\n  /**\r\n   * Closes the socket.\r\n   *\r\n   * @api private\r\n   */\n\n\n  doClose() {\n    if (this.script) {\n      // prevent spurious errors from being emitted when the window is unloaded\n      this.script.onerror = () => {};\n\n      this.script.parentNode.removeChild(this.script);\n      this.script = null;\n    }\n\n    if (this.form) {\n      this.form.parentNode.removeChild(this.form);\n      this.form = null;\n      this.iframe = null;\n    }\n\n    super.doClose();\n  }\n  /**\r\n   * Starts a poll cycle.\r\n   *\r\n   * @api private\r\n   */\n\n\n  doPoll() {\n    const script = document.createElement(\"script\");\n\n    if (this.script) {\n      this.script.parentNode.removeChild(this.script);\n      this.script = null;\n    }\n\n    script.async = true;\n    script.src = this.uri();\n\n    script.onerror = e => {\n      this.onError(\"jsonp poll error\", e);\n    };\n\n    const insertAt = document.getElementsByTagName(\"script\")[0];\n\n    if (insertAt) {\n      insertAt.parentNode.insertBefore(script, insertAt);\n    } else {\n      (document.head || document.body).appendChild(script);\n    }\n\n    this.script = script;\n    const isUAgecko = \"undefined\" !== typeof navigator && /gecko/i.test(navigator.userAgent);\n\n    if (isUAgecko) {\n      setTimeout(function () {\n        const iframe = document.createElement(\"iframe\");\n        document.body.appendChild(iframe);\n        document.body.removeChild(iframe);\n      }, 100);\n    }\n  }\n  /**\r\n   * Writes with a hidden iframe.\r\n   *\r\n   * @param {String} data to send\r\n   * @param {Function} called upon flush.\r\n   * @api private\r\n   */\n\n\n  doWrite(data, fn) {\n    let iframe;\n\n    if (!this.form) {\n      const form = document.createElement(\"form\");\n      const area = document.createElement(\"textarea\");\n      const id = this.iframeId = \"eio_iframe_\" + this.index;\n      form.className = \"socketio\";\n      form.style.position = \"absolute\";\n      form.style.top = \"-1000px\";\n      form.style.left = \"-1000px\";\n      form.target = id;\n      form.method = \"POST\";\n      form.setAttribute(\"accept-charset\", \"utf-8\");\n      area.name = \"d\";\n      form.appendChild(area);\n      document.body.appendChild(form);\n      this.form = form;\n      this.area = area;\n    }\n\n    this.form.action = this.uri();\n\n    function complete() {\n      initIframe();\n      fn();\n    }\n\n    const initIframe = () => {\n      if (this.iframe) {\n        try {\n          this.form.removeChild(this.iframe);\n        } catch (e) {\n          this.onError(\"jsonp polling iframe removal error\", e);\n        }\n      }\n\n      try {\n        // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n        const html = '<iframe src=\"javascript:0\" name=\"' + this.iframeId + '\">';\n        iframe = document.createElement(html);\n      } catch (e) {\n        iframe = document.createElement(\"iframe\");\n        iframe.name = this.iframeId;\n        iframe.src = \"javascript:0\";\n      }\n\n      iframe.id = this.iframeId;\n      this.form.appendChild(iframe);\n      this.iframe = iframe;\n    };\n\n    initIframe(); // escape \\n to prevent it from being converted into \\r\\n by some UAs\n    // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side\n\n    data = data.replace(rEscapedNewline, \"\\\\\\n\");\n    this.area.value = data.replace(rNewline, \"\\\\n\");\n\n    try {\n      this.form.submit();\n    } catch (e) {}\n\n    if (this.iframe.attachEvent) {\n      this.iframe.onreadystatechange = () => {\n        if (this.iframe.readyState === \"complete\") {\n          complete();\n        }\n      };\n    } else {\n      this.iframe.onload = complete;\n    }\n  }\n\n}\n\nmodule.exports = JSONPPolling;","map":{"version":3,"sources":["C:/Users/sebas/OneDrive/Desktop/Master Folder/Dev/Web Development/Talkanger/Talkanger/global-chat/node_modules/engine.io-client/lib/transports/polling-jsonp.js"],"names":["Polling","require","globalThis","rNewline","rEscapedNewline","callbacks","JSONPPolling","constructor","opts","query","___eio","index","length","push","onData","bind","j","supportsBinary","doClose","script","onerror","parentNode","removeChild","form","iframe","doPoll","document","createElement","async","src","uri","e","onError","insertAt","getElementsByTagName","insertBefore","head","body","appendChild","isUAgecko","navigator","test","userAgent","setTimeout","doWrite","data","fn","area","id","iframeId","className","style","position","top","left","target","method","setAttribute","name","action","complete","initIframe","html","replace","value","submit","attachEvent","onreadystatechange","readyState","onload","module","exports"],"mappings":"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","sourcesContent":["const Polling = require(\"./polling\");\r\nconst globalThis = require(\"../globalThis\");\r\n\r\nconst rNewline = /\\n/g;\r\nconst rEscapedNewline = /\\\\n/g;\r\n\r\n/**\r\n * Global JSONP callbacks.\r\n */\r\n\r\nlet callbacks;\r\n\r\nclass JSONPPolling extends Polling {\r\n  /**\r\n   * JSONP Polling constructor.\r\n   *\r\n   * @param {Object} opts.\r\n   * @api public\r\n   */\r\n  constructor(opts) {\r\n    super(opts);\r\n\r\n    this.query = this.query || {};\r\n\r\n    // define global callbacks array if not present\r\n    // we do this here (lazily) to avoid unneeded global pollution\r\n    if (!callbacks) {\r\n      // we need to consider multiple engines in the same page\r\n      callbacks = globalThis.___eio = globalThis.___eio || [];\r\n    }\r\n\r\n    // callback identifier\r\n    this.index = callbacks.length;\r\n\r\n    // add callback to jsonp global\r\n    callbacks.push(this.onData.bind(this));\r\n\r\n    // append to query string\r\n    this.query.j = this.index;\r\n  }\r\n\r\n  /**\r\n   * JSONP only supports binary as base64 encoded strings\r\n   */\r\n  get supportsBinary() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Closes the socket.\r\n   *\r\n   * @api private\r\n   */\r\n  doClose() {\r\n    if (this.script) {\r\n      // prevent spurious errors from being emitted when the window is unloaded\r\n      this.script.onerror = () => {};\r\n      this.script.parentNode.removeChild(this.script);\r\n      this.script = null;\r\n    }\r\n\r\n    if (this.form) {\r\n      this.form.parentNode.removeChild(this.form);\r\n      this.form = null;\r\n      this.iframe = null;\r\n    }\r\n\r\n    super.doClose();\r\n  }\r\n\r\n  /**\r\n   * Starts a poll cycle.\r\n   *\r\n   * @api private\r\n   */\r\n  doPoll() {\r\n    const script = document.createElement(\"script\");\r\n\r\n    if (this.script) {\r\n      this.script.parentNode.removeChild(this.script);\r\n      this.script = null;\r\n    }\r\n\r\n    script.async = true;\r\n    script.src = this.uri();\r\n    script.onerror = e => {\r\n      this.onError(\"jsonp poll error\", e);\r\n    };\r\n\r\n    const insertAt = document.getElementsByTagName(\"script\")[0];\r\n    if (insertAt) {\r\n      insertAt.parentNode.insertBefore(script, insertAt);\r\n    } else {\r\n      (document.head || document.body).appendChild(script);\r\n    }\r\n    this.script = script;\r\n\r\n    const isUAgecko =\r\n      \"undefined\" !== typeof navigator && /gecko/i.test(navigator.userAgent);\r\n\r\n    if (isUAgecko) {\r\n      setTimeout(function() {\r\n        const iframe = document.createElement(\"iframe\");\r\n        document.body.appendChild(iframe);\r\n        document.body.removeChild(iframe);\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes with a hidden iframe.\r\n   *\r\n   * @param {String} data to send\r\n   * @param {Function} called upon flush.\r\n   * @api private\r\n   */\r\n  doWrite(data, fn) {\r\n    let iframe;\r\n\r\n    if (!this.form) {\r\n      const form = document.createElement(\"form\");\r\n      const area = document.createElement(\"textarea\");\r\n      const id = (this.iframeId = \"eio_iframe_\" + this.index);\r\n\r\n      form.className = \"socketio\";\r\n      form.style.position = \"absolute\";\r\n      form.style.top = \"-1000px\";\r\n      form.style.left = \"-1000px\";\r\n      form.target = id;\r\n      form.method = \"POST\";\r\n      form.setAttribute(\"accept-charset\", \"utf-8\");\r\n      area.name = \"d\";\r\n      form.appendChild(area);\r\n      document.body.appendChild(form);\r\n\r\n      this.form = form;\r\n      this.area = area;\r\n    }\r\n\r\n    this.form.action = this.uri();\r\n\r\n    function complete() {\r\n      initIframe();\r\n      fn();\r\n    }\r\n\r\n    const initIframe = () => {\r\n      if (this.iframe) {\r\n        try {\r\n          this.form.removeChild(this.iframe);\r\n        } catch (e) {\r\n          this.onError(\"jsonp polling iframe removal error\", e);\r\n        }\r\n      }\r\n\r\n      try {\r\n        // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\r\n        const html = '<iframe src=\"javascript:0\" name=\"' + this.iframeId + '\">';\r\n        iframe = document.createElement(html);\r\n      } catch (e) {\r\n        iframe = document.createElement(\"iframe\");\r\n        iframe.name = this.iframeId;\r\n        iframe.src = \"javascript:0\";\r\n      }\r\n\r\n      iframe.id = this.iframeId;\r\n\r\n      this.form.appendChild(iframe);\r\n      this.iframe = iframe;\r\n    };\r\n\r\n    initIframe();\r\n\r\n    // escape \\n to prevent it from being converted into \\r\\n by some UAs\r\n    // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side\r\n    data = data.replace(rEscapedNewline, \"\\\\\\n\");\r\n    this.area.value = data.replace(rNewline, \"\\\\n\");\r\n\r\n    try {\r\n      this.form.submit();\r\n    } catch (e) {}\r\n\r\n    if (this.iframe.attachEvent) {\r\n      this.iframe.onreadystatechange = () => {\r\n        if (this.iframe.readyState === \"complete\") {\r\n          complete();\r\n        }\r\n      };\r\n    } else {\r\n      this.iframe.onload = complete;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = JSONPPolling;\r\n"]},"metadata":{},"sourceType":"script"}